from .cart import Cart

def round_decimals_to_two(num):
    rounded = str(round(float(num), 2))
    if "." in rounded:
        dec = rounded.split(".")[1]
        if dec == "0":
            rounded = rounded.split(".")[0]
        elif len(dec) == 1:
            rounded = rounded + "0"
    return rounded

def cart_total_amount(request):
	if request.user.is_authenticated:
		cart = Cart(request)
		total_bill = 0.0
		for key,value in request.session['cart'].items():
			total_bill = total_bill + (float(value['price']) * value['quantity'])
		total_bill = round_decimals_to_two(total_bill)
		delivery = "4.00" if float(total_bill) <= 15 else "0.00"
		order_total = round_decimals_to_two(float(total_bill)+float(delivery)) if delivery != "0.00" else total_bill
		return {'cart_total_amount' : total_bill,
				'delivery' : delivery,
				'order_total' : order_total
			} 
	else:
		return {'cart_total_amount' : 0} 